<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Chat Assistant</title>
    <meta name="description" content="Your AI Chat Assistant" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/styles.css?v=1.0" />
    <style>
      body {
        background: #181825;
        color: #fff;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        margin: 0;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      main {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 60vh;
        width: 100vw;
      }
      h1 {
        font-size: 2.2rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        letter-spacing: -1px;
      }
      p {
        font-size: 1.1rem;
        color: #b3b3b3;
        margin-bottom: 2rem;
        text-align: center;
        max-width: 90vw;
      }
      @media (max-width: 600px) {
        h1 { font-size: 1.5rem; }
        p { font-size: 1rem; }
        main { min-height: 40vh; }
      }
    </style>
  </head>

  <body>
    <main>
      <h1>Welcome to Your AI Chat Assistant</h1>
      <p>Tap the chat bubble at the bottom right to start a conversation. Fast, private, and always available.</p>
    </main>

    <script src="/script.js"></script>
    <!-- n8n Chat Widget -->
    <script src="https://unpkg.com/@n8n/chat@1.0.0/dist/web.js"></script>
    <script>
      // Add error handling to help diagnose issues
      document.addEventListener('DOMContentLoaded', function() {
        console.log("DOM loaded, attempting to initialize chat...");
        
        // Check every 500ms for 10 seconds if n8nChat is available
        let attempts = 0;
        const maxAttempts = 20;
        
        const initInterval = setInterval(function() {
          attempts++;
          
          if (typeof window.n8nChat !== 'undefined') {
            console.log("n8nChat is available, initializing...");
            try {
              window.n8nChat.mount({
                webhookUrl: 'https://primary-production-5417.up.railway.app/webhook/a889d2ae-2159-402f-b326-5f61e90f602e/chat',
                theme: {
                  position: 'bottom-right',
                  colorScheme: 'dark',
                }
              });
              console.log("n8n chat initialized successfully!");
              clearInterval(initInterval);
            } catch (error) {
              console.error("Error during initialization:", error);
            }
          } else {
            console.log(`Waiting for n8nChat to load (attempt ${attempts}/${maxAttempts})...`);
            if (attempts >= maxAttempts) {
              console.error("Failed to load n8nChat after maximum attempts");
              clearInterval(initInterval);
              
              // Display a fallback button if the widget fails to load
              const main = document.querySelector('main');
              const fallbackButton = document.createElement('button');
              fallbackButton.innerText = 'Start Chat';
              fallbackButton.style.padding = '10px 20px';
              fallbackButton.style.backgroundColor = '#7c3aed';
              fallbackButton.style.color = 'white';
              fallbackButton.style.border = 'none';
              fallbackButton.style.borderRadius = '4px';
              fallbackButton.style.cursor = 'pointer';
              fallbackButton.style.fontSize = '16px';
              fallbackButton.onclick = function() {
                window.open('https://primary-production-5417.up.railway.app/webhook/a889d2ae-2159-402f-b326-5f61e90f602e/chat', '_blank');
              };
              main.appendChild(fallbackButton);
            }
          }
        }, 500);
      });
    </script>
  </body>
</html>
